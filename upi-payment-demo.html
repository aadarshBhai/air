<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UPI Payment Demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2rem;
        }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .product-card {
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .product-card:hover {
            border-color: #667eea;
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .product-card.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .product-name {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .product-price {
            font-size: 1.5rem;
            font-weight: 700;
            color: #667eea;
        }

        .product-card.selected .product-price {
            color: white;
        }

        .payment-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            display: none;
        }

        .payment-section.active {
            display: block;
        }

        .upi-details {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        .detail-row:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .detail-label {
            font-weight: 600;
            color: #666;
        }

        .detail-value {
            font-weight: 700;
            color: #333;
        }

        .amount-display {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
        }

        .amount-label {
            font-size: 1rem;
            margin-bottom: 10px;
        }

        .amount-value {
            font-size: 2.5rem;
            font-weight: 700;
        }

        .pay-button {
            width: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 18px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .pay-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .pay-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .upi-apps {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }

        .upi-app {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .upi-app:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .upi-id-display {
            background: #e8f4fd;
            border: 2px dashed #667eea;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            margin-bottom: 20px;
        }

        .upi-id-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
        }

        .upi-id-value {
            font-size: 1.1rem;
            font-weight: 700;
            color: #667eea;
            word-break: break-all;
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 1.5rem;
            }

            .amount-value {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üõçÔ∏è Select Product & Pay</h1>
        
        <div class="product-grid" id="productGrid">
            <!-- Products will be dynamically added here -->
        </div>

        <div class="payment-section" id="paymentSection">
            <div class="amount-display">
                <div class="amount-label">Amount to Pay</div>
                <div class="amount-value" id="amountValue">‚Çπ0</div>
            </div>

            <div class="upi-details">
                <div class="upi-id-display">
                    <div class="upi-id-label">UPI ID</div>
                    <div class="upi-id-value">9065588337ayush@ybl</div>
                </div>

                <div class="detail-row">
                    <span class="detail-label">Payee Name:</span>
                    <span class="detail-value">Ayush</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Product:</span>
                    <span class="detail-value" id="selectedProduct">-</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Transaction Note:</span>
                    <span class="detail-value">Product Payment</span>
                </div>
            </div>

            <div class="upi-apps">
                <div class="upi-app" onclick="openUpiApp('gpay')">üí∞ Google Pay</div>
                <div class="upi-app" onclick="openUpiApp('phonepe')">üîµ PhonePe</div>
                <div class="upi-app" onclick="openUpiApp('paytm')">üí∏ Paytm</div>
                <div class="upi-app" onclick="openUpiApp('paytmall')">üõí Paytm Mall</div>
                <div class="upi-app" onclick="openUpiApp('bhim')">üáÆüá≥ BHIM UPI</div>
            </div>

            <button class="pay-button" id="payButton" onclick="proceedToPayment()">
                üöÄ Pay Now
            </button>
        </div>
    </div>

    <script>
        // TypeScript-like interfaces (using JSDoc for better type checking)
        /**
         * @typedef {Object} Product
         * @property {string} id
         * @property {string} name
         * @property {number} price
         * @property {string} description
         */

        /**
         * @typedef {Object} UPIDetails
         * @property {string} pa - Payee Address (UPI ID)
         * @property {string} pn - Payee Name
         * @property {string} am - Amount
         * @property {string} cu - Currency
         * @property {string} tn - Transaction Note
         */

        // Configuration
        const UPI_CONFIG = {
            UPI_ID: "9065588337ayush@ybl",
            PAYEE_NAME: "Ayush",
            CURRENCY: "INR",
            TRANSACTION_NOTE: "Product Payment"
        };

        // Product data
        /**
         * @type {Product[]}
         */
        const products = [
            {
                id: "1",
                name: "Wireless Earbuds",
                price: 2999,
                description: "Premium wireless earbuds with noise cancellation"
            },
            {
                id: "2", 
                name: "Smart Watch",
                price: 4999,
                description: "Fitness tracker with heart rate monitor"
            },
            {
                id: "3",
                name: "Laptop Stand",
                price: 1299,
                description: "Adjustable aluminum laptop stand"
            },
            {
                id: "4",
                name: "USB-C Hub",
                price: 1999,
                description: "7-in-1 USB-C hub with HDMI"
            },
            {
                id: "5",
                name: "Bluetooth Speaker",
                price: 3499,
                description: "Portable waterproof speaker"
            },
            {
                id: "6",
                name: "Phone Case",
                price: 599,
                description: "Premium shockproof phone case"
            }
        ];

        // State management
        let selectedProduct = null;

        /**
         * Generates a UPI payment link with proper URL encoding
         * @param {Product} product - The selected product
         * @returns {string} - The generated UPI deep link
         */
        function generateUPILink(product) {
            const upiDetails = {
                pa: UPI_CONFIG.UPI_ID,
                pn: UPI_CONFIG.PAYEE_NAME,
                am: product.price.toString(),
                cu: UPI_CONFIG.CURRENCY,
                tn: `${UPI_CONFIG.TRANSACTION_NOTE} - ${product.name}`
            };

            // Create UPI URL with proper encoding
            const upiUrl = `upi://pay?pa=${encodeURIComponent(upiDetails.pa)}&pn=${encodeURIComponent(upiDetails.pn)}&am=${encodeURIComponent(upiDetails.am)}&cu=${encodeURIComponent(upiDetails.cu)}&tn=${encodeURIComponent(upiDetails.tn)}`;
            
            console.log('Generated UPI URL:', upiUrl);
            console.log('UPI Details:', upiDetails);
            
            return upiUrl;
        }

        /**
         * Generates app-specific UPI URLs
         * @param {Product} product - The selected product
         * @param {string} appName - The UPI app name
         * @returns {string} - The app-specific UPI URL
         */
        function generateAppSpecificUPILink(product, appName) {
            const baseParams = `pa=${encodeURIComponent(UPI_CONFIG.UPI_ID)}&pn=${encodeURIComponent(UPI_CONFIG.PAYEE_NAME)}&am=${encodeURIComponent(product.price.toString())}&cu=${encodeURIComponent(UPI_CONFIG.CURRENCY)}&tn=${encodeURIComponent(`${UPI_CONFIG.TRANSACTION_NOTE} - ${product.name}`)}`;
            
            switch(appName.toLowerCase()) {
                case 'gpay':
                case 'google pay':
                    return `tez://upi/pay?${baseParams}`;
                case 'phonepe':
                    return `phonepe://pay?${baseParams}`;
                case 'paytm':
                    return `paytmmp://pay?${baseParams}`;
                case 'paytmall':
                    return `paytmmp://pay?${baseParams}`;
                case 'bhim':
                    return `bhim://upi/pay?${baseParams}`;
                default:
                    return `upi://pay?${baseParams}`;
            }
        }

        /**
         * Handles product selection
         * @param {Product} product - The selected product
         */
        function selectProduct(product) {
            selectedProduct = product;
            
            // Update UI
            document.querySelectorAll('.product-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            event.currentTarget.classList.add('selected');
            
            // Show payment section with product details
            const paymentSection = document.getElementById('paymentSection');
            const amountValue = document.getElementById('amountValue');
            const selectedProductName = document.getElementById('selectedProduct');
            
            paymentSection.classList.add('active');
            amountValue.textContent = `‚Çπ${product.price}`;
            selectedProductName.textContent = product.name;
            
            // Enable pay button
            document.getElementById('payButton').disabled = false;
        }

        /**
         * Opens UPI app directly
         * @param {string} appName - The UPI app to open
         */
        function openUpiApp(appName) {
            if (!selectedProduct) {
                alert('Please select a product first');
                return;
            }

            const upiUrl = generateAppSpecificUPILink(selectedProduct, appName);
            
            // Detect mobile device
            const isMobile = /android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase());
            
            if (isMobile) {
                // Try to open the UPI app
                window.location.href = upiUrl;
                
                // Fallback after 2 seconds
                setTimeout(() => {
                    const fallbackUrl = generateUPILink(selectedProduct);
                    window.location.href = fallbackUrl;
                }, 2000);
            } else {
                // Desktop - copy UPI ID and show instructions
                copyUPIId();
                alert(`Desktop detected! UPI ID copied: ${UPI_CONFIG.UPI_ID}\n\nPlease open your UPI app manually and pay ‚Çπ${selectedProduct.price}`);
            }
        }

        /**
         * Proceeds to payment with generated UPI link
         */
        function proceedToPayment() {
            if (!selectedProduct) {
                alert('Please select a product first');
                return;
            }

            const upiUrl = generateUPILink(selectedProduct);
            
            // Detect mobile device
            const isMobile = /android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase());
            
            if (isMobile) {
                // Mobile - redirect to UPI app
                window.location.href = upiUrl;
            } else {
                // Desktop - copy UPI ID and show instructions
                copyUPIId();
                alert(`Desktop detected! UPI ID copied: ${UPI_CONFIG.UPI_ID}\n\nPlease open your UPI app manually and pay ‚Çπ${selectedProduct.price}`);
            }
        }

        /**
         * Copies UPI ID to clipboard
         */
        function copyUPIId() {
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(UPI_CONFIG.UPI_ID).then(() => {
                    console.log('UPI ID copied to clipboard');
                }).catch(err => {
                    console.error('Failed to copy UPI ID:', err);
                });
            }
        }

        /**
         * Renders products in the grid
         */
        function renderProducts() {
            const productGrid = document.getElementById('productGrid');
            
            products.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                productCard.onclick = () => selectProduct(product);
                
                productCard.innerHTML = `
                    <div class="product-name">${product.name}</div>
                    <div class="product-price">‚Çπ${product.price}</div>
                    <div style="color: #666; font-size: 0.9rem; margin-top: 10px;">
                        ${product.description}
                    </div>
                `;
                
                productGrid.appendChild(productCard);
            });
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            renderProducts();
            console.log('UPI Payment Demo initialized');
            console.log('Available products:', products);
        });
    </script>
</body>
</html>
